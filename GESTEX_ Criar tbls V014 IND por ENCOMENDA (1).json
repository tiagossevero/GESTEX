[
{
  "model": "desktop.document2",
  "pk": 203265,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "GESTEX: Criar tbls V014 IND por ENCOMENDA",
    "description": "",
    "uuid": "d3e8befb-6395-2b79-dfb6-148279234297",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 203265, \"uuid\": \"4f1b8551-71d6-4d16-b1f5-4f06d234f5b1\", \"name\": \"GESTEX: Criar tbls V014 IND por ENCOMENDA\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"d3e8befb-6395-2b79-dfb6-148279234297\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"623be268-f028-98dd-a8b5-b9e117315544\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Query\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 781, \"column\": 67}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ================================================================\\r\\n-- GESTEX \\u2014 Projeto V014: Industrializa\\u00e7\\u00e3o por Encomenda\\r\\n-- CRIA\\u00c7\\u00c3O DE TABELAS ANAL\\u00cdTICAS \\u2014 BigData Impala/Hue\\r\\n-- Schema: teste.gestex_v014_*\\r\\n-- Ano: 2025, Meses: 1 a 12\\r\\n-- ================================================================\\r\\n-- Sintaxe: implicit join (FROM tabela a, a.array_field b)\\r\\n-- Padr\\u00e3o validado no projeto GEI (nfe.nfe / nfce.nfce)\\r\\n-- ================================================================\\r\\n\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 1: REMESSAS ENVIADAS (Sa\\u00eddas 5901/6901)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_remessas_enviadas;\\r\\nCREATE TABLE teste.gestex_v014_remessas_enviadas AS\\r\\nSELECT\\r\\n    c.identificadorarquivo,\\r\\n    c.ano_referencia,\\r\\n    c.mes_referencia,\\r\\n    c.chv_nfe,\\r\\n    c.num_doc,\\r\\n    c.dt_doc,\\r\\n    c.dt_e_s,\\r\\n    c.cod_part                    AS cod_part_industrializador,\\r\\n    c.vl_doc,\\r\\n    c.vl_merc,\\r\\n    c.cod_sit,\\r\\n    it.num_item,\\r\\n    it.cod_item,\\r\\n    it.cfop,\\r\\n    it.unid,\\r\\n    it.qtd,\\r\\n    it.vl_item,\\r\\n    it.vl_desc,\\r\\n    it.cst_icms,\\r\\n    it.aliq_icms,\\r\\n    it.vl_icms,\\r\\n    it.vl_ipi\\r\\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\nWHERE c.ano_referencia = 2025\\r\\n  AND c.mes_referencia BETWEEN 1 AND 12\\r\\n  AND c.ind_oper = 1\\r\\n  AND c.cod_sit = 0\\r\\n  AND it.cfop IN (5901, 6901)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 2: REMESSAS RECEBIDAS (Entradas 5901/6901)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_remessas_recebidas;\\r\\nCREATE TABLE teste.gestex_v014_remessas_recebidas AS\\r\\nSELECT\\r\\n    c.identificadorarquivo,\\r\\n    c.ano_referencia,\\r\\n    c.mes_referencia,\\r\\n    c.chv_nfe,\\r\\n    c.num_doc,\\r\\n    c.dt_doc,\\r\\n    c.dt_e_s,\\r\\n    c.cod_part                    AS cod_part_encomendante,\\r\\n    c.vl_doc,\\r\\n    it.num_item,\\r\\n    it.cod_item,\\r\\n    it.cfop,\\r\\n    it.unid,\\r\\n    it.qtd,\\r\\n    it.vl_item,\\r\\n    it.cst_icms,\\r\\n    it.aliq_icms,\\r\\n    it.vl_icms\\r\\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\nWHERE c.ano_referencia = 2025\\r\\n  AND c.mes_referencia BETWEEN 1 AND 12\\r\\n  AND c.ind_oper = 0\\r\\n  AND c.cod_sit = 0\\r\\n  AND it.cfop IN (5901, 6901)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 3: FLUXO COMPLETO (Todos CFOPs industrializa\\u00e7\\u00e3o + participante + item)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_fluxo_completo;\\r\\nCREATE TABLE teste.gestex_v014_fluxo_completo AS\\r\\nSELECT\\r\\n    c.identificadorarquivo,\\r\\n    c.ano_referencia,\\r\\n    c.mes_referencia,\\r\\n    c.chv_nfe,\\r\\n    c.num_doc,\\r\\n    c.dt_doc,\\r\\n    c.ind_oper,\\r\\n    c.vl_doc,\\r\\n    c.cod_sit,\\r\\n    c.cod_part,\\r\\n    p.nome                        AS nome_participante,\\r\\n    p.cnpj                        AS cnpj_participante,\\r\\n    p.ie                          AS ie_participante,\\r\\n    p.cod_mun                     AS municipio_participante,\\r\\n    it.cfop,\\r\\n    it.cod_item,\\r\\n    prod.descr_item,\\r\\n    prod.cod_ncm,\\r\\n    prod.tipo_item,\\r\\n    it.unid,\\r\\n    it.qtd,\\r\\n    it.vl_item,\\r\\n    it.aliq_icms,\\r\\n    it.vl_icms\\r\\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\nLEFT JOIN efd.efd_r0150 p\\r\\n    ON c.identificadorarquivo = p.identificadorarquivo\\r\\n    AND c.cod_part = p.cod_part\\r\\n    AND p.ano_referencia = 2025\\r\\n    AND p.mes_referencia = c.mes_referencia\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON c.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND it.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = 2025\\r\\n    AND prod.mes_referencia = c.mes_referencia\\r\\nWHERE c.ano_referencia = 2025\\r\\n  AND c.mes_referencia BETWEEN 1 AND 12\\r\\n  AND c.cod_sit = 0\\r\\n  AND it.cfop IN (5901, 6901, 5902, 6902, 5124, 6124, 5125, 6125, 5903, 6903, 5924, 6924, 5925, 6925)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 4: RETORNOS DE INDUSTRIALIZA\\u00c7\\u00c3O\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_retornos;\\r\\nCREATE TABLE teste.gestex_v014_retornos AS\\r\\nSELECT\\r\\n    c.identificadorarquivo,\\r\\n    c.ano_referencia,\\r\\n    c.mes_referencia,\\r\\n    c.chv_nfe,\\r\\n    c.dt_doc,\\r\\n    c.ind_oper,\\r\\n    c.cod_part,\\r\\n    c.vl_doc,\\r\\n    c.vl_merc,\\r\\n    it.num_item,\\r\\n    it.cod_item,\\r\\n    it.cfop,\\r\\n    it.unid,\\r\\n    it.qtd,\\r\\n    it.vl_item,\\r\\n    it.cst_icms,\\r\\n    it.aliq_icms,\\r\\n    it.vl_icms,\\r\\n    it.vl_icms_st,\\r\\n    it.vl_ipi\\r\\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\nWHERE c.ano_referencia = 2025\\r\\n  AND c.mes_referencia BETWEEN 1 AND 12\\r\\n  AND c.cod_sit = 0\\r\\n  AND it.cfop IN (5902, 6902, 5903, 6903, 5925, 6925)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 5: COBRAN\\u00c7A DA INDUSTRIALIZA\\u00c7\\u00c3O (XXXX-XXXX-XXXX-XXXX)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_cobranca_industrializacao;\\r\\nCREATE TABLE teste.gestex_v014_cobranca_industrializacao AS\\r\\nSELECT\\r\\n    c.identificadorarquivo,\\r\\n    c.ano_referencia,\\r\\n    c.mes_referencia,\\r\\n    c.chv_nfe,\\r\\n    c.dt_doc,\\r\\n    c.cod_part                    AS cod_part_encomendante,\\r\\n    c.vl_doc,\\r\\n    it.num_item,\\r\\n    it.cod_item,\\r\\n    it.cfop,\\r\\n    it.unid,\\r\\n    it.qtd,\\r\\n    it.vl_item                  AS vl_industrializacao,\\r\\n    it.cst_icms,\\r\\n    it.aliq_icms,\\r\\n    it.vl_icms                  AS icms_valor_agregado,\\r\\n    it.vl_ipi\\r\\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\nWHERE c.ano_referencia = 2025\\r\\n  AND c.mes_referencia BETWEEN 1 AND 12\\r\\n  AND c.ind_oper = 1\\r\\n  AND c.cod_sit = 0\\r\\n  AND it.cfop IN (5124, 6124, 5125, 6125)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 6: PRODU\\u00c7\\u00c3O PR\\u00d3PRIA K230 + K235 (Com insumos)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_producao_k230;\\r\\nCREATE TABLE teste.gestex_v014_producao_k230 AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.ano_referencia,\\r\\n    k.mes_referencia,\\r\\n    k.datainicialapuracao,\\r\\n    k.datafinalapuracao,\\r\\n    k.cod_doc_op,\\r\\n    k.dt_ini_op,\\r\\n    k.dt_fin_op,\\r\\n    k.cod_item                    AS cod_item_produzido,\\r\\n    k.qtd_enc                    AS qtd_produzida,\\r\\n    insumo.cod_item              AS cod_item_insumo,\\r\\n    insumo.qtd                   AS qtd_insumo_consumida,\\r\\n    insumo.cod_ins_subst         AS cod_insumo_substituto\\r\\nFROM efd.efd_rk230 k, k.listark235_insumosconsumidos insumo\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 7: PRODU\\u00c7\\u00c3O COM DESCRI\\u00c7\\u00c3O (Produzido + Insumos enriquecidos)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_producao_descrita;\\r\\nCREATE TABLE teste.gestex_v014_producao_descrita AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.mes_referencia,\\r\\n    k.cod_doc_op,\\r\\n    k.dt_ini_op,\\r\\n    k.dt_fin_op,\\r\\n    k.cod_item                    AS cod_produzido,\\r\\n    prod.descr_item              AS desc_produzido,\\r\\n    prod.cod_ncm                 AS ncm_produzido,\\r\\n    prod.tipo_item               AS tipo_produzido,\\r\\n    k.qtd_enc                    AS qtd_produzida,\\r\\n    insumo.cod_item              AS cod_insumo,\\r\\n    ins.descr_item               AS desc_insumo,\\r\\n    ins.cod_ncm                  AS ncm_insumo,\\r\\n    ins.tipo_item                AS tipo_insumo,\\r\\n    insumo.qtd                   AS qtd_insumo\\r\\nFROM efd.efd_rk230 k, k.listark235_insumosconsumidos insumo\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON k.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND k.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = 2025\\r\\n    AND prod.mes_referencia = k.mes_referencia\\r\\nLEFT JOIN efd.efd_r0200 ins\\r\\n    ON k.identificadorarquivo = ins.identificadorarquivo\\r\\n    AND insumo.cod_item = ins.cod_item\\r\\n    AND ins.ano_referencia = 2025\\r\\n    AND ins.mes_referencia = k.mes_referencia\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 8: FICHA T\\u00c9CNICA IMPL\\u00cdCITA (Raz\\u00e3o insumo/produto)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_ficha_tecnica;\\r\\nCREATE TABLE teste.gestex_v014_ficha_tecnica AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.cod_item                    AS cod_produzido,\\r\\n    prod.descr_item              AS desc_produzido,\\r\\n    prod.cod_ncm                 AS ncm_produzido,\\r\\n    insumo.cod_item              AS cod_insumo,\\r\\n    ins.descr_item               AS desc_insumo,\\r\\n    ins.cod_ncm                  AS ncm_insumo,\\r\\n    SUM(k.qtd_enc)               AS total_produzido,\\r\\n    SUM(insumo.qtd)              AS total_insumo_consumido,\\r\\n    CASE WHEN SUM(k.qtd_enc) > 0\\r\\n         THEN ROUND(SUM(insumo.qtd) / SUM(k.qtd_enc), 4)\\r\\n         ELSE NULL END           AS razao_insumo_por_produto,\\r\\n    COUNT(*)                     AS qtd_ordens_producao\\r\\nFROM efd.efd_rk230 k, k.listark235_insumosconsumidos insumo\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON k.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND k.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = 2025\\r\\n    AND prod.mes_referencia = k.mes_referencia\\r\\nLEFT JOIN efd.efd_r0200 ins\\r\\n    ON k.identificadorarquivo = ins.identificadorarquivo\\r\\n    AND insumo.cod_item = ins.cod_item\\r\\n    AND ins.ano_referencia = 2025\\r\\n    AND ins.mes_referencia = k.mes_referencia\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\nGROUP BY\\r\\n    k.identificadorarquivo,\\r\\n    k.cod_item, prod.descr_item, prod.cod_ncm,\\r\\n    insumo.cod_item, ins.descr_item, ins.cod_ncm\\r\\nHAVING SUM(k.qtd_enc) > 0\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 9: INDUSTRIALIZA\\u00c7\\u00c3O POR TERCEIROS K250 + K255\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_industrializacao_terceiros;\\r\\nCREATE TABLE teste.gestex_v014_industrializacao_terceiros AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.ano_referencia,\\r\\n    k.mes_referencia,\\r\\n    k.datainicialapuracao,\\r\\n    k.datafinalapuracao,\\r\\n    k.dt_prod,\\r\\n    k.cod_item                    AS cod_item_produzido,\\r\\n    prod.descr_item              AS desc_produzido,\\r\\n    prod.cod_ncm                 AS ncm_produzido,\\r\\n    k.qtd                        AS qtd_produzida,\\r\\n    insumo.cod_item              AS cod_item_insumo,\\r\\n    ins.descr_item               AS desc_insumo,\\r\\n    ins.cod_ncm                  AS ncm_insumo,\\r\\n    insumo.qtd                   AS qtd_insumo_consumida,\\r\\n    insumo.cod_ins_subst\\r\\nFROM efd.efd_rk250 k, k.listark255_insumosconsumidosterceiros insumo\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON k.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND k.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = 2025\\r\\n    AND prod.mes_referencia = k.mes_referencia\\r\\nLEFT JOIN efd.efd_r0200 ins\\r\\n    ON k.identificadorarquivo = ins.identificadorarquivo\\r\\n    AND insumo.cod_item = ins.cod_item\\r\\n    AND ins.ano_referencia = 2025\\r\\n    AND ins.mes_referencia = k.mes_referencia\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 10: INVENT\\u00c1RIO F\\u00cdSICO H010 (Sem arrays)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_inventario;\\r\\nCREATE TABLE teste.gestex_v014_inventario AS\\r\\nSELECT\\r\\n    h.identificadorarquivo,\\r\\n    h.ano_referencia,\\r\\n    h.mes_referencia,\\r\\n    h.datadoinventario,\\r\\n    h.cod_item,\\r\\n    prod.descr_item,\\r\\n    prod.cod_ncm,\\r\\n    prod.tipo_item,\\r\\n    h.unid,\\r\\n    h.qtd,\\r\\n    h.vl_unit,\\r\\n    h.vl_item,\\r\\n    h.ind_prop,\\r\\n    CASE h.ind_prop\\r\\n        WHEN 0 THEN 'Proprio'\\r\\n        WHEN 1 THEN 'Terceiros'\\r\\n        WHEN 2 THEN 'Proprio c/ terceiros'\\r\\n    END AS propriedade_desc,\\r\\n    h.cod_part,\\r\\n    p.nome                        AS nome_proprietario,\\r\\n    p.cnpj                        AS cnpj_proprietario\\r\\nFROM efd.efd_rh010 h\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON h.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND h.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = h.ano_referencia\\r\\n    AND prod.mes_referencia = h.mes_referencia\\r\\nLEFT JOIN efd.efd_r0150 p\\r\\n    ON h.identificadorarquivo = p.identificadorarquivo\\r\\n    AND h.cod_part = p.cod_part\\r\\n    AND p.ano_referencia = h.ano_referencia\\r\\n    AND p.mes_referencia = h.mes_referencia\\r\\nWHERE h.ano_referencia = 2025\\r\\n  AND h.mes_referencia = 2\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 11: RESUMO INVENT\\u00c1RIO POR PROPRIEDADE\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_inventario_resumo;\\r\\nCREATE TABLE teste.gestex_v014_inventario_resumo AS\\r\\nSELECT\\r\\n    h.identificadorarquivo,\\r\\n    h.datadoinventario,\\r\\n    h.ind_prop,\\r\\n    CASE h.ind_prop\\r\\n        WHEN 0 THEN 'Proprio'\\r\\n        WHEN 1 THEN 'Terceiros'\\r\\n        WHEN 2 THEN 'Proprio c/ terceiros'\\r\\n    END AS propriedade,\\r\\n    COUNT(DISTINCT h.cod_item)    AS qtd_itens,\\r\\n    SUM(h.vl_item)               AS vl_total,\\r\\n    COUNT(DISTINCT h.cod_part)   AS qtd_parceiros\\r\\nFROM efd.efd_rh010 h\\r\\nWHERE h.ano_referencia = 2025\\r\\n  AND h.mes_referencia = 2\\r\\nGROUP BY h.identificadorarquivo, h.datadoinventario, h.ind_prop\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 12: ESTOQUE ESCRITURADO K200 (Terceiros \\u2014 Sem arrays)\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_estoque_terceiros;\\r\\nCREATE TABLE teste.gestex_v014_estoque_terceiros AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.ano_referencia,\\r\\n    k.mes_referencia,\\r\\n    k.dt_est,\\r\\n    k.cod_item,\\r\\n    prod.descr_item,\\r\\n    prod.cod_ncm,\\r\\n    prod.tipo_item,\\r\\n    k.qtd,\\r\\n    k.ind_est,\\r\\n    CASE k.ind_est\\r\\n        WHEN 0 THEN 'Proprio'\\r\\n        WHEN 1 THEN 'Terceiros'\\r\\n        WHEN 2 THEN 'Proprio c/ terceiros'\\r\\n    END AS estoque_desc,\\r\\n    k.cod_part,\\r\\n    p.nome                        AS nome_proprietario,\\r\\n    p.cnpj                        AS cnpj_proprietario\\r\\nFROM efd.efd_rk200 k\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON k.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND k.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = k.ano_referencia\\r\\n    AND prod.mes_referencia = k.mes_referencia\\r\\nLEFT JOIN efd.efd_r0150 p\\r\\n    ON k.identificadorarquivo = p.identificadorarquivo\\r\\n    AND k.cod_part = p.cod_part\\r\\n    AND p.ano_referencia = k.ano_referencia\\r\\n    AND p.mes_referencia = k.mes_referencia\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\n  AND k.ind_est = 1\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 13: EVOLU\\u00c7\\u00c3O MENSAL ESTOQUE DE TERCEIROS\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_estoque_evolucao;\\r\\nCREATE TABLE teste.gestex_v014_estoque_evolucao AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.mes_referencia,\\r\\n    k.ind_est,\\r\\n    COUNT(DISTINCT k.cod_item)    AS qtd_itens,\\r\\n    SUM(k.qtd)                   AS qtd_total,\\r\\n    COUNT(DISTINCT k.cod_part)   AS qtd_parceiros\\r\\nFROM efd.efd_rk200 k\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.ind_est IN (1, 2)\\r\\nGROUP BY k.identificadorarquivo, k.mes_referencia, k.ind_est\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 14: PAINEL CONSOLIDADO REMESSA vs RETORNO vs INDUSTRIALIZA\\u00c7\\u00c3O\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_painel_consolidado;\\r\\nCREATE TABLE teste.gestex_v014_painel_consolidado AS\\r\\nWITH remessas AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n),\\r\\nretornos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5902, 6902, 5903, 6903)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n),\\r\\nindustrializacao AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5124, 6124, 5125, 6125)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    COALESCE(r.identificadorarquivo, ret.identificadorarquivo, ind.identificadorarquivo) AS identificadorarquivo,\\r\\n    COALESCE(r.cod_part, ret.cod_part, ind.cod_part)   AS cod_part,\\r\\n    COALESCE(r.cod_item, ret.cod_item, ind.cod_item)   AS cod_item,\\r\\n    r.qtd_total                   AS qtd_remetida,\\r\\n    r.vl_total                    AS vl_remetido,\\r\\n    r.qtd_notas                   AS notas_remessa,\\r\\n    ret.qtd_total                 AS qtd_retornada,\\r\\n    ret.vl_total                  AS vl_retornado,\\r\\n    ret.qtd_notas                 AS notas_retorno,\\r\\n    ind.qtd_total                 AS qtd_industrializada,\\r\\n    ind.vl_total                  AS vl_industrializacao,\\r\\n    ind.qtd_notas                 AS notas_industrializacao,\\r\\n    COALESCE(r.qtd_total, 0) - COALESCE(ret.qtd_total, 0) AS saldo_qtd,\\r\\n    COALESCE(r.vl_total, 0) - COALESCE(ret.vl_total, 0)   AS saldo_valor\\r\\nFROM remessas r\\r\\nFULL OUTER JOIN retornos ret\\r\\n    ON r.identificadorarquivo = ret.identificadorarquivo\\r\\n    AND r.cod_part = ret.cod_part\\r\\n    AND r.cod_item = ret.cod_item\\r\\nFULL OUTER JOIN industrializacao ind\\r\\n    ON COALESCE(r.identificadorarquivo, ret.identificadorarquivo) = ind.identificadorarquivo\\r\\n    AND COALESCE(r.cod_part, ret.cod_part) = ind.cod_part\\r\\n    AND COALESCE(r.cod_item, ret.cod_item) = ind.cod_item\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 15: ANOMALIA \\u2014 REMESSAS SEM RETORNO\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_sem_retorno;\\r\\nCREATE TABLE teste.gestex_v014_anomalia_sem_retorno AS\\r\\nWITH remessas AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.chv_nfe,\\r\\n        c.dt_doc,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        it.qtd,\\r\\n        it.vl_item\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 1\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n),\\r\\nretornos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd) AS qtd_retornada\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5902, 6902, 5903, 6903)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    r.chv_nfe,\\r\\n    r.dt_doc,\\r\\n    r.cod_part,\\r\\n    r.cod_item,\\r\\n    r.qtd                         AS qtd_remetida,\\r\\n    r.vl_item                     AS vl_remetido,\\r\\n    COALESCE(ret.qtd_retornada, 0) AS qtd_retornada,\\r\\n    r.qtd - COALESCE(ret.qtd_retornada, 0) AS qtd_pendente,\\r\\n    'REMESSA SEM RETORNO' AS anomalia\\r\\nFROM remessas r\\r\\nLEFT JOIN retornos ret\\r\\n    ON r.identificadorarquivo = ret.identificadorarquivo\\r\\n    AND r.cod_part = ret.cod_part\\r\\n    AND r.cod_item = ret.cod_item\\r\\nWHERE COALESCE(ret.qtd_retornada, 0) < r.qtd * 0.9\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 16: ANOMALIA \\u2014 INDUSTRIALIZADOR SEM ESTOQUE DE TERCEIROS\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_sem_estoque;\\r\\nCREATE TABLE teste.gestex_v014_anomalia_sem_estoque AS\\r\\nWITH recebimentos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas_recebidas,\\r\\n        SUM(it.vl_item)        AS vl_total_recebido,\\r\\n        COUNT(DISTINCT c.cod_part) AS qtd_encomendantes\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n    GROUP BY c.identificadorarquivo\\r\\n    HAVING SUM(it.vl_item) > 0\\r\\n),\\r\\nestoques_terceiros AS (\\r\\n    SELECT\\r\\n        k.identificadorarquivo,\\r\\n        SUM(k.qtd)               AS qtd_estoque_terceiros,\\r\\n        COUNT(DISTINCT k.cod_item) AS itens_terceiros\\r\\n    FROM efd.efd_rk200 k\\r\\n    WHERE k.ano_referencia = 2025\\r\\n      AND k.mes_referencia BETWEEN 1 AND 12\\r\\n      AND k.ind_est = 1\\r\\n    GROUP BY k.identificadorarquivo\\r\\n)\\r\\nSELECT\\r\\n    r.identificadorarquivo,\\r\\n    r.qtd_notas_recebidas,\\r\\n    r.vl_total_recebido,\\r\\n    r.qtd_encomendantes,\\r\\n    COALESCE(e.itens_terceiros, 0) AS itens_estoque_terceiros,\\r\\n    'SEM ESTOQUE TERCEIROS DECLARADO' AS status_anomalia\\r\\nFROM recebimentos r\\r\\nLEFT JOIN estoques_terceiros e\\r\\n    ON r.identificadorarquivo = e.identificadorarquivo\\r\\nWHERE e.identificadorarquivo IS NULL\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 17: ANOMALIA \\u2014 PRODU\\u00c7\\u00c3O SEM REMESSA\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_producao_sem_remessa;\\r\\nCREATE TABLE teste.gestex_v014_anomalia_producao_sem_remessa AS\\r\\nWITH producao AS (\\r\\n    SELECT\\r\\n        k.identificadorarquivo,\\r\\n        k.mes_referencia,\\r\\n        insumo.cod_item            AS cod_insumo,\\r\\n        SUM(insumo.qtd)           AS qtd_insumo_consumido\\r\\n    FROM efd.efd_rk230 k, k.listark235_insumosconsumidos insumo\\r\\n    WHERE k.ano_referencia = 2025\\r\\n      AND k.mes_referencia BETWEEN 1 AND 12\\r\\n    GROUP BY k.identificadorarquivo, k.mes_referencia, insumo.cod_item\\r\\n),\\r\\nentradas_insumos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.mes_referencia,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_recebida\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5901, 6901, 1901, 2901)\\r\\n    GROUP BY c.identificadorarquivo, c.mes_referencia, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    p.identificadorarquivo,\\r\\n    p.mes_referencia,\\r\\n    p.cod_insumo,\\r\\n    p.qtd_insumo_consumido,\\r\\n    COALESCE(e.qtd_recebida, 0)  AS qtd_recebida_remessa,\\r\\n    p.qtd_insumo_consumido - COALESCE(e.qtd_recebida, 0) AS diferenca,\\r\\n    CASE WHEN COALESCE(e.qtd_recebida, 0) = 0\\r\\n         THEN 'CONSUMO SEM REMESSA'\\r\\n         WHEN p.qtd_insumo_consumido > e.qtd_recebida * 1.1\\r\\n         THEN 'CONSUMO > REMESSA (>10%)'\\r\\n         ELSE 'OK'\\r\\n    END AS status\\r\\nFROM producao p\\r\\nLEFT JOIN entradas_insumos e\\r\\n    ON p.identificadorarquivo = e.identificadorarquivo\\r\\n    AND p.cod_insumo = e.cod_item\\r\\nWHERE COALESCE(e.qtd_recebida, 0) < p.qtd_insumo_consumido * 0.9\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 18: AJUSTES E111 (Cr\\u00e9dito Presumido / Benef\\u00edcios)\\r\\n-- Hier\\u00e1rquica: efd.efd \\u2192 blocoe \\u2192 E110 \\u2192 E111\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_ajustes_e111;\\r\\nCREATE TABLE teste.gestex_v014_ajustes_e111 AS\\r\\nSELECT\\r\\n    e.codigocnpj,\\r\\n    e.periodoreferencia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_debitos    AS vl_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_creditos   AS vl_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_debitos AS vl_aj_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_creditos AS vl_aj_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_icms_recolher  AS vl_recolher,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_sld_credor_transportar AS vl_sld_credor,\\r\\n    ajuste.cod_aj_apur,\\r\\n    ajuste.descr_compl_aj,\\r\\n    ajuste.vl_aj_apur\\r\\nFROM efd.efd e,\\r\\n     e.efd.blocoe.listaperiodosapuracaoicms periodo,\\r\\n     periodo.re110_apuracaoicms_operacaopropria.listare111_ajustebeneficioincentivo_icms ajuste\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA AUXILIAR: MAPEAMENTO CNPJ \\u2192 IDENTIFICADORARQUIVO\\r\\n-- ================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_mapa_contribuintes;\\r\\nCREATE TABLE teste.gestex_v014_mapa_contribuintes AS\\r\\nSELECT DISTINCT\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.identificadorarquivo AS identificadorarquivo,\\r\\n    e.codigocnpj,\\r\\n    e.nomeempresarial,\\r\\n    e.numeroinscricaoestadual AS ie,\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.cod_mun AS cod_municipio,\\r\\n    e.efd.bloco0.r0005_dadoscomplementaresentidade.fantasia AS nome_fantasia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia\\r\\nFROM efd.efd e\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- VALIDA\\u00c7\\u00c3O DAS TABELAS CRIADAS\\r\\n-- ================================================================\\r\\n\\r\\nSELECT 'teste.gestex_v014_remessas_enviadas' AS tabela, COUNT(*) AS registros FROM teste.gestex_v014_remessas_enviadas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_remessas_recebidas', COUNT(*) FROM teste.gestex_v014_remessas_recebidas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_fluxo_completo', COUNT(*) FROM teste.gestex_v014_fluxo_completo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_retornos', COUNT(*) FROM teste.gestex_v014_retornos\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_cobranca_industrializacao', COUNT(*) FROM teste.gestex_v014_cobranca_industrializacao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_k230', COUNT(*) FROM teste.gestex_v014_producao_k230\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_descrita', COUNT(*) FROM teste.gestex_v014_producao_descrita\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ficha_tecnica', COUNT(*) FROM teste.gestex_v014_ficha_tecnica\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_industrializacao_terceiros', COUNT(*) FROM teste.gestex_v014_industrializacao_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario', COUNT(*) FROM teste.gestex_v014_inventario\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario_resumo', COUNT(*) FROM teste.gestex_v014_inventario_resumo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_terceiros', COUNT(*) FROM teste.gestex_v014_estoque_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_evolucao', COUNT(*) FROM teste.gestex_v014_estoque_evolucao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_painel_consolidado', COUNT(*) FROM teste.gestex_v014_painel_consolidado\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_retorno', COUNT(*) FROM teste.gestex_v014_anomalia_sem_retorno\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_estoque', COUNT(*) FROM teste.gestex_v014_anomalia_sem_estoque\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_producao_sem_remessa', COUNT(*) FROM teste.gestex_v014_anomalia_producao_sem_remessa\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ajustes_e111', COUNT(*) FROM teste.gestex_v014_ajustes_e111\\r\\nORDER BY 1;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- FIM \\u2014 18 tabelas no schema teste.gestex_v014_*\\r\\n-- ================================================================\", \"statementsList\": [\"\\r\\nCREATE TABLE teste.gestex_v014_estoque_terceiros AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.ano_referencia,\\r\\n    k.mes_referencia,\\r\\n    k.dt_est,\\r\\n    k.cod_item,\\r\\n    prod.descr_item,\\r\\n    prod.cod_ncm,\\r\\n    prod.tipo_item,\\r\\n    k.qtd,\\r\\n    k.ind_est,\\r\\n    CASE k.ind_est\\r\\n        WHEN 0 THEN 'Proprio'\\r\\n        WHEN 1 THEN 'Terceiros'\\r\\n        WHEN 2 THEN 'Proprio c/ terceiros'\\r\\n    END AS estoque_desc,\\r\\n    k.cod_part,\\r\\n    p.nome                        AS nome_proprietario,\\r\\n    p.cnpj                        AS cnpj_proprietario\\r\\nFROM efd.efd_rk200 k\\r\\nLEFT JOIN efd.efd_r0200 prod\\r\\n    ON k.identificadorarquivo = prod.identificadorarquivo\\r\\n    AND k.cod_item = prod.cod_item\\r\\n    AND prod.ano_referencia = k.ano_referencia\\r\\n    AND prod.mes_referencia = k.mes_referencia\\r\\nLEFT JOIN efd.efd_r0150 p\\r\\n    ON k.identificadorarquivo = p.identificadorarquivo\\r\\n    AND k.cod_part = p.cod_part\\r\\n    AND p.ano_referencia = k.ano_referencia\\r\\n    AND p.mes_referencia = k.mes_referencia\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.mes_referencia BETWEEN 1 AND 12\\r\\n  AND k.ind_est = 1\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 13: EVOLU\\u00c7\\u00c3O MENSAL ESTOQUE DE TERCEIROS\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_estoque_evolucao;\", \"\\r\\nCREATE TABLE teste.gestex_v014_estoque_evolucao AS\\r\\nSELECT\\r\\n    k.identificadorarquivo,\\r\\n    k.mes_referencia,\\r\\n    k.ind_est,\\r\\n    COUNT(DISTINCT k.cod_item)    AS qtd_itens,\\r\\n    SUM(k.qtd)                   AS qtd_total,\\r\\n    COUNT(DISTINCT k.cod_part)   AS qtd_parceiros\\r\\nFROM efd.efd_rk200 k\\r\\nWHERE k.ano_referencia = 2025\\r\\n  AND k.ind_est IN (1, 2)\\r\\nGROUP BY k.identificadorarquivo, k.mes_referencia, k.ind_est\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 14: PAINEL CONSOLIDADO REMESSA vs RETORNO vs INDUSTRIALIZA\\u00c7\\u00c3O\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_painel_consolidado;\", \"\\r\\nCREATE TABLE teste.gestex_v014_painel_consolidado AS\\r\\nWITH remessas AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n),\\r\\nretornos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5902, 6902, 5903, 6903)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n),\\r\\nindustrializacao AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_total,\\r\\n        SUM(it.vl_item)        AS vl_total,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND it.cfop IN (5124, 6124, 5125, 6125)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    COALESCE(r.identificadorarquivo, ret.identificadorarquivo, ind.identificadorarquivo) AS identificadorarquivo,\\r\\n    COALESCE(r.cod_part, ret.cod_part, ind.cod_part)   AS cod_part,\\r\\n    COALESCE(r.cod_item, ret.cod_item, ind.cod_item)   AS cod_item,\\r\\n    r.qtd_total                   AS qtd_remetida,\\r\\n    r.vl_total                    AS vl_remetido,\\r\\n    r.qtd_notas                   AS notas_remessa,\\r\\n    ret.qtd_total                 AS qtd_retornada,\\r\\n    ret.vl_total                  AS vl_retornado,\\r\\n    ret.qtd_notas                 AS notas_retorno,\\r\\n    ind.qtd_total                 AS qtd_industrializada,\\r\\n    ind.vl_total                  AS vl_industrializacao,\\r\\n    ind.qtd_notas                 AS notas_industrializacao,\\r\\n    COALESCE(r.qtd_total, 0) - COALESCE(ret.qtd_total, 0) AS saldo_qtd,\\r\\n    COALESCE(r.vl_total, 0) - COALESCE(ret.vl_total, 0)   AS saldo_valor\\r\\nFROM remessas r\\r\\nFULL OUTER JOIN retornos ret\\r\\n    ON r.identificadorarquivo = ret.identificadorarquivo\\r\\n    AND r.cod_part = ret.cod_part\\r\\n    AND r.cod_item = ret.cod_item\\r\\nFULL OUTER JOIN industrializacao ind\\r\\n    ON COALESCE(r.identificadorarquivo, ret.identificadorarquivo) = ind.identificadorarquivo\\r\\n    AND COALESCE(r.cod_part, ret.cod_part) = ind.cod_part\\r\\n    AND COALESCE(r.cod_item, ret.cod_item) = ind.cod_item\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 15: ANOMALIA \\u2014 REMESSAS SEM RETORNO\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_sem_retorno;\", \"\\r\\nCREATE TABLE teste.gestex_v014_anomalia_sem_retorno AS\\r\\nWITH remessas AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.chv_nfe,\\r\\n        c.dt_doc,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        it.qtd,\\r\\n        it.vl_item\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 1\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n),\\r\\nretornos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.cod_part,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd) AS qtd_retornada\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5902, 6902, 5903, 6903)\\r\\n    GROUP BY c.identificadorarquivo, c.cod_part, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    r.chv_nfe,\\r\\n    r.dt_doc,\\r\\n    r.cod_part,\\r\\n    r.cod_item,\\r\\n    r.qtd                         AS qtd_remetida,\\r\\n    r.vl_item                     AS vl_remetido,\\r\\n    COALESCE(ret.qtd_retornada, 0) AS qtd_retornada,\\r\\n    r.qtd - COALESCE(ret.qtd_retornada, 0) AS qtd_pendente,\\r\\n    'REMESSA SEM RETORNO' AS anomalia\\r\\nFROM remessas r\\r\\nLEFT JOIN retornos ret\\r\\n    ON r.identificadorarquivo = ret.identificadorarquivo\\r\\n    AND r.cod_part = ret.cod_part\\r\\n    AND r.cod_item = ret.cod_item\\r\\nWHERE COALESCE(ret.qtd_retornada, 0) < r.qtd * 0.9\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 16: ANOMALIA \\u2014 INDUSTRIALIZADOR SEM ESTOQUE DE TERCEIROS\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_sem_estoque;\", \"\\r\\nCREATE TABLE teste.gestex_v014_anomalia_sem_estoque AS\\r\\nWITH recebimentos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        COUNT(DISTINCT c.chv_nfe) AS qtd_notas_recebidas,\\r\\n        SUM(it.vl_item)        AS vl_total_recebido,\\r\\n        COUNT(DISTINCT c.cod_part) AS qtd_encomendantes\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5901, 6901)\\r\\n    GROUP BY c.identificadorarquivo\\r\\n    HAVING SUM(it.vl_item) > 0\\r\\n),\\r\\nestoques_terceiros AS (\\r\\n    SELECT\\r\\n        k.identificadorarquivo,\\r\\n        SUM(k.qtd)               AS qtd_estoque_terceiros,\\r\\n        COUNT(DISTINCT k.cod_item) AS itens_terceiros\\r\\n    FROM efd.efd_rk200 k\\r\\n    WHERE k.ano_referencia = 2025\\r\\n      AND k.mes_referencia BETWEEN 1 AND 12\\r\\n      AND k.ind_est = 1\\r\\n    GROUP BY k.identificadorarquivo\\r\\n)\\r\\nSELECT\\r\\n    r.identificadorarquivo,\\r\\n    r.qtd_notas_recebidas,\\r\\n    r.vl_total_recebido,\\r\\n    r.qtd_encomendantes,\\r\\n    COALESCE(e.itens_terceiros, 0) AS itens_estoque_terceiros,\\r\\n    'SEM ESTOQUE TERCEIROS DECLARADO' AS status_anomalia\\r\\nFROM recebimentos r\\r\\nLEFT JOIN estoques_terceiros e\\r\\n    ON r.identificadorarquivo = e.identificadorarquivo\\r\\nWHERE e.identificadorarquivo IS NULL\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 17: ANOMALIA \\u2014 PRODU\\u00c7\\u00c3O SEM REMESSA\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_anomalia_producao_sem_remessa;\", \"\\r\\nCREATE TABLE teste.gestex_v014_anomalia_producao_sem_remessa AS\\r\\nWITH producao AS (\\r\\n    SELECT\\r\\n        k.identificadorarquivo,\\r\\n        k.mes_referencia,\\r\\n        insumo.cod_item            AS cod_insumo,\\r\\n        SUM(insumo.qtd)           AS qtd_insumo_consumido\\r\\n    FROM efd.efd_rk230 k, k.listark235_insumosconsumidos insumo\\r\\n    WHERE k.ano_referencia = 2025\\r\\n      AND k.mes_referencia BETWEEN 1 AND 12\\r\\n    GROUP BY k.identificadorarquivo, k.mes_referencia, insumo.cod_item\\r\\n),\\r\\nentradas_insumos AS (\\r\\n    SELECT\\r\\n        c.identificadorarquivo,\\r\\n        c.mes_referencia,\\r\\n        it.cod_item,\\r\\n        SUM(it.qtd)             AS qtd_recebida\\r\\n    FROM efd.efd_rc100 c, c.listarc170_itensdocumento it\\r\\n    WHERE c.ano_referencia = 2025\\r\\n      AND c.mes_referencia BETWEEN 1 AND 12\\r\\n      AND c.cod_sit = 0\\r\\n      AND c.ind_oper = 0\\r\\n      AND it.cfop IN (5901, 6901, 1901, 2901)\\r\\n    GROUP BY c.identificadorarquivo, c.mes_referencia, it.cod_item\\r\\n)\\r\\nSELECT\\r\\n    p.identificadorarquivo,\\r\\n    p.mes_referencia,\\r\\n    p.cod_insumo,\\r\\n    p.qtd_insumo_consumido,\\r\\n    COALESCE(e.qtd_recebida, 0)  AS qtd_recebida_remessa,\\r\\n    p.qtd_insumo_consumido - COALESCE(e.qtd_recebida, 0) AS diferenca,\\r\\n    CASE WHEN COALESCE(e.qtd_recebida, 0) = 0\\r\\n         THEN 'CONSUMO SEM REMESSA'\\r\\n         WHEN p.qtd_insumo_consumido > e.qtd_recebida * 1.1\\r\\n         THEN 'CONSUMO > REMESSA (>10%)'\\r\\n         ELSE 'OK'\\r\\n    END AS status\\r\\nFROM producao p\\r\\nLEFT JOIN entradas_insumos e\\r\\n    ON p.identificadorarquivo = e.identificadorarquivo\\r\\n    AND p.cod_insumo = e.cod_item\\r\\nWHERE COALESCE(e.qtd_recebida, 0) < p.qtd_insumo_consumido * 0.9\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA 18: AJUSTES E111 (Cr\\u00e9dito Presumido / Benef\\u00edcios)\\r\\n-- Hier\\u00e1rquica: efd.efd \\u2192 blocoe \\u2192 E110 \\u2192 E111\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_ajustes_e111;\", \"\\r\\nCREATE TABLE teste.gestex_v014_ajustes_e111 AS\\r\\nSELECT\\r\\n    e.codigocnpj,\\r\\n    e.periodoreferencia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_debitos    AS vl_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_creditos   AS vl_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_debitos AS vl_aj_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_creditos AS vl_aj_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_icms_recolher  AS vl_recolher,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_sld_credor_transportar AS vl_sld_credor,\\r\\n    ajuste.cod_aj_apur,\\r\\n    ajuste.descr_compl_aj,\\r\\n    ajuste.vl_aj_apur\\r\\nFROM efd.efd e,\\r\\n     e.efd.blocoe.listaperiodosapuracaoicms periodo,\\r\\n     periodo.re110_apuracaoicms_operacaopropria.listare111_ajustebeneficioincentivo_icms ajuste\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\", \"\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA AUXILIAR: MAPEAMENTO CNPJ \\u2192 IDENTIFICADORARQUIVO\\r\\n-- ================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_mapa_contribuintes;\", \"\\r\\nCREATE TABLE teste.gestex_v014_mapa_contribuintes AS\\r\\nSELECT DISTINCT\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.identificadorarquivo AS identificadorarquivo,\\r\\n    e.codigocnpj,\\r\\n    e.nomeempresarial,\\r\\n    e.numeroinscricaoestadual AS ie,\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.cod_mun AS cod_municipio,\\r\\n    e.efd.bloco0.r0005_dadoscomplementaresentidade.fantasia AS nome_fantasia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia\\r\\nFROM efd.efd e\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\", \"\\r\\n\\r\\n-- ================================================================\\r\\n-- VALIDA\\u00c7\\u00c3O DAS TABELAS CRIADAS\\r\\n-- ================================================================\\r\\n\\r\\nSELECT 'teste.gestex_v014_remessas_enviadas' AS tabela, COUNT(*) AS registros FROM teste.gestex_v014_remessas_enviadas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_remessas_recebidas', COUNT(*) FROM teste.gestex_v014_remessas_recebidas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_fluxo_completo', COUNT(*) FROM teste.gestex_v014_fluxo_completo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_retornos', COUNT(*) FROM teste.gestex_v014_retornos\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_cobranca_industrializacao', COUNT(*) FROM teste.gestex_v014_cobranca_industrializacao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_k230', COUNT(*) FROM teste.gestex_v014_producao_k230\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_descrita', COUNT(*) FROM teste.gestex_v014_producao_descrita\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ficha_tecnica', COUNT(*) FROM teste.gestex_v014_ficha_tecnica\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_industrializacao_terceiros', COUNT(*) FROM teste.gestex_v014_industrializacao_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario', COUNT(*) FROM teste.gestex_v014_inventario\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario_resumo', COUNT(*) FROM teste.gestex_v014_inventario_resumo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_terceiros', COUNT(*) FROM teste.gestex_v014_estoque_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_evolucao', COUNT(*) FROM teste.gestex_v014_estoque_evolucao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_painel_consolidado', COUNT(*) FROM teste.gestex_v014_painel_consolidado\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_retorno', COUNT(*) FROM teste.gestex_v014_anomalia_sem_retorno\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_estoque', COUNT(*) FROM teste.gestex_v014_anomalia_sem_estoque\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_producao_sem_remessa', COUNT(*) FROM teste.gestex_v014_anomalia_producao_sem_remessa\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ajustes_e111', COUNT(*) FROM teste.gestex_v014_ajustes_e111\\r\\nORDER BY 1;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- FIM \\u2014 18 tabelas no schema teste.gestex_v014_*\\r\\n-- ================================================================\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Example: SELECT * FROM tablename, or press CTRL + space\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n-- ================================================================\\r\\n-- TABELA 18: AJUSTES E111 (Cr\\u00e9dito Presumido / Benef\\u00edcios)\\r\\n-- Hier\\u00e1rquica: efd.efd \\u2192 blocoe \\u2192 E110 \\u2192 E111\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_ajustes_e111;\\r\\nCREATE TABLE teste.gestex_v014_ajustes_e111 AS\\r\\nSELECT\\r\\n    e.codigocnpj,\\r\\n    e.periodoreferencia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_debitos    AS vl_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_creditos   AS vl_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_debitos AS vl_aj_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_creditos AS vl_aj_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_icms_recolher  AS vl_recolher,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_sld_credor_transportar AS vl_sld_credor,\\r\\n    ajuste.cod_aj_apur,\\r\\n    ajuste.descr_compl_aj,\\r\\n    ajuste.vl_aj_apur\\r\\nFROM efd.efd e,\\r\\n     e.efd.blocoe.listaperiodosapuracaoicms periodo,\\r\\n     periodo.re110_apuracaoicms_operacaopropria.listare111_ajustebeneficioincentivo_icms ajuste\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA AUXILIAR: MAPEAMENTO CNPJ \\u2192 IDENTIFICADORARQUIVO\\r\\n-- ================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_mapa_contribuintes;\\r\\nCREATE TABLE teste.gestex_v014_mapa_contribuintes AS\\r\\nSELECT DISTINCT\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.identificadorarquivo AS identificadorarquivo,\\r\\n    e.codigocnpj,\\r\\n    e.nomeempresarial,\\r\\n    e.numeroinscricaoestadual AS ie,\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.cod_mun AS cod_municipio,\\r\\n    e.efd.bloco0.r0005_dadoscomplementaresentidade.fantasia AS nome_fantasia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia\\r\\nFROM efd.efd e\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- VALIDA\\u00c7\\u00c3O DAS TABELAS CRIADAS\\r\\n-- ================================================================\\r\\n\\r\\nSELECT 'teste.gestex_v014_remessas_enviadas' AS tabela, COUNT(*) AS registros FROM teste.gestex_v014_remessas_enviadas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_remessas_recebidas', COUNT(*) FROM teste.gestex_v014_remessas_recebidas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_fluxo_completo', COUNT(*) FROM teste.gestex_v014_fluxo_completo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_retornos', COUNT(*) FROM teste.gestex_v014_retornos\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_cobranca_industrializacao', COUNT(*) FROM teste.gestex_v014_cobranca_industrializacao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_k230', COUNT(*) FROM teste.gestex_v014_producao_k230\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_descrita', COUNT(*) FROM teste.gestex_v014_producao_descrita\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ficha_tecnica', COUNT(*) FROM teste.gestex_v014_ficha_tecnica\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_industrializacao_terceiros', COUNT(*) FROM teste.gestex_v014_industrializacao_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario', COUNT(*) FROM teste.gestex_v014_inventario\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario_resumo', COUNT(*) FROM teste.gestex_v014_inventario_resumo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_terceiros', COUNT(*) FROM teste.gestex_v014_estoque_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_evolucao', COUNT(*) FROM teste.gestex_v014_estoque_evolucao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_painel_consolidado', COUNT(*) FROM teste.gestex_v014_painel_consolidado\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_retorno', COUNT(*) FROM teste.gestex_v014_anomalia_sem_retorno\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_estoque', COUNT(*) FROM teste.gestex_v014_anomalia_sem_estoque\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_producao_sem_remessa', COUNT(*) FROM teste.gestex_v014_anomalia_producao_sem_remessa\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ajustes_e111', COUNT(*) FROM teste.gestex_v014_ajustes_e111\\r\\nORDER BY 1;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- FIM \\u2014 18 tabelas no schema teste.gestex_v014_*\\r\\n-- ================================================================\", \"result\": {\"id\": \"748e52fc-3946-8def-fbb6-d52ef03fe13f\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"mGccCRpGRI+1qsN+6F5P5Q==\", \"guid\": \"OHeen31eTYUAAAAAcY50HQ==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"d64827b133271b4a:b1d54212e4d7efa7\", \"session_id\": 26163, \"session_type\": \"impala\", \"statement_id\": 4, \"has_more_statements\": true, \"statements_count\": 6, \"previous_statement_hash\": \"15bb7b20142510ee52c36a9407fecb45ca78c335c764a3eed41acbe1\", \"start\": {\"row\": 48, \"column\": 0}, \"end\": {\"row\": 87, \"column\": 11}, \"statement\": \"-- ================================================================\\n-- VALIDA\\u00c7\\u00c3O DAS TABELAS CRIADAS\\n-- ================================================================\\n\\nSELECT 'teste.gestex_v014_remessas_enviadas' AS tabela, COUNT(*) AS registros FROM teste.gestex_v014_remessas_enviadas\\nUNION ALL\\nSELECT 'teste.gestex_v014_remessas_recebidas', COUNT(*) FROM teste.gestex_v014_remessas_recebidas\\nUNION ALL\\nSELECT 'teste.gestex_v014_fluxo_completo', COUNT(*) FROM teste.gestex_v014_fluxo_completo\\nUNION ALL\\nSELECT 'teste.gestex_v014_retornos', COUNT(*) FROM teste.gestex_v014_retornos\\nUNION ALL\\nSELECT 'teste.gestex_v014_cobranca_industrializacao', COUNT(*) FROM teste.gestex_v014_cobranca_industrializacao\\nUNION ALL\\nSELECT 'teste.gestex_v014_producao_k230', COUNT(*) FROM teste.gestex_v014_producao_k230\\nUNION ALL\\nSELECT 'teste.gestex_v014_producao_descrita', COUNT(*) FROM teste.gestex_v014_producao_descrita\\nUNION ALL\\nSELECT 'teste.gestex_v014_ficha_tecnica', COUNT(*) FROM teste.gestex_v014_ficha_tecnica\\nUNION ALL\\nSELECT 'teste.gestex_v014_industrializacao_terceiros', COUNT(*) FROM teste.gestex_v014_industrializacao_terceiros\\nUNION ALL\\nSELECT 'teste.gestex_v014_inventario', COUNT(*) FROM teste.gestex_v014_inventario\\nUNION ALL\\nSELECT 'teste.gestex_v014_inventario_resumo', COUNT(*) FROM teste.gestex_v014_inventario_resumo\\nUNION ALL\\nSELECT 'teste.gestex_v014_estoque_terceiros', COUNT(*) FROM teste.gestex_v014_estoque_terceiros\\nUNION ALL\\nSELECT 'teste.gestex_v014_estoque_evolucao', COUNT(*) FROM teste.gestex_v014_estoque_evolucao\\nUNION ALL\\nSELECT 'teste.gestex_v014_painel_consolidado', COUNT(*) FROM teste.gestex_v014_painel_consolidado\\nUNION ALL\\nSELECT 'teste.gestex_v014_anomalia_sem_retorno', COUNT(*) FROM teste.gestex_v014_anomalia_sem_retorno\\nUNION ALL\\nSELECT 'teste.gestex_v014_anomalia_sem_estoque', COUNT(*) FROM teste.gestex_v014_anomalia_sem_estoque\\nUNION ALL\\nSELECT 'teste.gestex_v014_anomalia_producao_sem_remessa', COUNT(*) FROM teste.gestex_v014_anomalia_producao_sem_remessa\\nUNION ALL\\nSELECT 'teste.gestex_v014_ajustes_e111', COUNT(*) FROM teste.gestex_v014_ajustes_e111\\nORDER BY 1\"}, \"meta\": [], \"rows\": 18, \"hasMore\": false, \"statement_id\": 4, \"statement_range\": {\"start\": {\"row\": 48, \"column\": 0}, \"end\": {\"row\": 87, \"column\": 11}}, \"statements_count\": 6, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 2, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"tabela\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"registros\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 2}], \"fetchedOnce\": false, \"startTime\": \"2026-02-18T20:34:31.151Z\", \"endTime\": \"2026-02-18T20:34:33.083Z\", \"executionTime\": 1932, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 12, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 7632, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": true, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"tabela\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"registros\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"summary\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 7688, \"getLogsTimeout\": 7730, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1771446870886, \"lastAceSelectionRowOffset\": 689, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"\\r\\n-- ================================================================\\r\\n-- TABELA 18: AJUSTES E111 (Cr\\u00e9dito Presumido / Benef\\u00edcios)\\r\\n-- Hier\\u00e1rquica: efd.efd \\u2192 blocoe \\u2192 E110 \\u2192 E111\\r\\n-- ================================================================\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_ajustes_e111;\\r\\nCREATE TABLE teste.gestex_v014_ajustes_e111 AS\\r\\nSELECT\\r\\n    e.codigocnpj,\\r\\n    e.periodoreferencia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_debitos    AS vl_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_creditos   AS vl_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_debitos AS vl_aj_debitos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_tot_aj_creditos AS vl_aj_creditos,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_icms_recolher  AS vl_recolher,\\r\\n    periodo.re110_apuracaoicms_operacaopropria.vl_sld_credor_transportar AS vl_sld_credor,\\r\\n    ajuste.cod_aj_apur,\\r\\n    ajuste.descr_compl_aj,\\r\\n    ajuste.vl_aj_apur\\r\\nFROM efd.efd e,\\r\\n     e.efd.blocoe.listaperiodosapuracaoicms periodo,\\r\\n     periodo.re110_apuracaoicms_operacaopropria.listare111_ajustebeneficioincentivo_icms ajuste\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- TABELA AUXILIAR: MAPEAMENTO CNPJ \\u2192 IDENTIFICADORARQUIVO\\r\\n-- ================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS teste.gestex_v014_mapa_contribuintes;\\r\\nCREATE TABLE teste.gestex_v014_mapa_contribuintes AS\\r\\nSELECT DISTINCT\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.identificadorarquivo AS identificadorarquivo,\\r\\n    e.codigocnpj,\\r\\n    e.nomeempresarial,\\r\\n    e.numeroinscricaoestadual AS ie,\\r\\n    e.efd.bloco0.r0000_identificacaoarquivo.cod_mun AS cod_municipio,\\r\\n    e.efd.bloco0.r0005_dadoscomplementaresentidade.fantasia AS nome_fantasia,\\r\\n    e.ano_referencia,\\r\\n    e.mes_referencia\\r\\nFROM efd.efd e\\r\\nWHERE e.ano_referencia = 2025\\r\\n  AND e.mes_referencia BETWEEN 1 AND 12\\r\\n;\\r\\n\\r\\n-- ================================================================\\r\\n-- VALIDA\\u00c7\\u00c3O DAS TABELAS CRIADAS\\r\\n-- ================================================================\\r\\n\\r\\nSELECT 'teste.gestex_v014_remessas_enviadas' AS tabela, COUNT(*) AS registros FROM teste.gestex_v014_remessas_enviadas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_remessas_recebidas', COUNT(*) FROM teste.gestex_v014_remessas_recebidas\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_fluxo_completo', COUNT(*) FROM teste.gestex_v014_fluxo_completo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_retornos', COUNT(*) FROM teste.gestex_v014_retornos\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_cobranca_industrializacao', COUNT(*) FROM teste.gestex_v014_cobranca_industrializacao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_k230', COUNT(*) FROM teste.gestex_v014_producao_k230\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_producao_descrita', COUNT(*) FROM teste.gestex_v014_producao_descrita\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ficha_tecnica', COUNT(*) FROM teste.gestex_v014_ficha_tecnica\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_industrializacao_terceiros', COUNT(*) FROM teste.gestex_v014_industrializacao_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario', COUNT(*) FROM teste.gestex_v014_inventario\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_inventario_resumo', COUNT(*) FROM teste.gestex_v014_inventario_resumo\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_terceiros', COUNT(*) FROM teste.gestex_v014_estoque_terceiros\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_estoque_evolucao', COUNT(*) FROM teste.gestex_v014_estoque_evolucao\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_painel_consolidado', COUNT(*) FROM teste.gestex_v014_painel_consolidado\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_retorno', COUNT(*) FROM teste.gestex_v014_anomalia_sem_retorno\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_sem_estoque', COUNT(*) FROM teste.gestex_v014_anomalia_sem_estoque\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_anomalia_producao_sem_remessa', COUNT(*) FROM teste.gestex_v014_anomalia_producao_sem_remessa\\r\\nUNION ALL\\r\\nSELECT 'teste.gestex_v014_ajustes_e111', COUNT(*) FROM teste.gestex_v014_ajustes_e111\\r\\nORDER BY 1;\\r\\n\\r\\n\\r\\n-- ================================================================\\r\\n-- FIM \\u2014 18 tabelas no schema teste.gestex_v014_*\\r\\n-- ================================================================\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 689, \"column\": 0}, \"end\": {\"row\": 781, \"column\": 67}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query 854d5e7d9f9e7738:1d748e7100000000 100% Complete (192 out of 192)\\\\nIgnoring ORDER BY clause without LIMIT or OFFSET: ORDER BY 1 ASC.\\\\nAn ORDER BY appearing in a view, subquery, union operand, or an insert/ctas statement has no effect on the query result unless a LIMIT and/or OFFSET is used in conjunction with the ORDER BY.\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"854d5e7d9f9e7738:1d748e7100000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=854d5e7d9f9e7738:1d748e7100000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query 854d5e7d9f9e7738:1d748e7100000000 100% Complete (192 out of 192)\\nIgnoring ORDER BY clause without LIMIT or OFFSET: ORDER BY 1 ASC.\\nAn ORDER BY appearing in a view, subquery, union operand, or an insert/ctas statement has no effect on the query result unless a LIMIT and/or OFFSET is used in conjunction with the ORDER BY.\", \"progress\": 100, \"jobs\": [{\"name\": \"854d5e7d9f9e7738:1d748e7100000000\", \"url\": \"/hue/jobbrowser#!id=854d5e7d9f9e7738:1d748e7100000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 10876.381818, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 264, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "-- ================================================================\r\n-- GESTEX  Projeto V014: Industrializao por Encomenda\r\n-- CRIAO DE TABELAS ANALTICAS  BigData Impala/Hue\r\n-- Schema: teste.gestex_v014_*\r\n-- Ano: 2025, Meses: 1 a 12\r\n-- ================================================================\r\n-- Sintaxe: implicit join (FROM tabela a, a.array_field b)\r\n-- Padro validado no projeto GEI (nfe.nfe / nfce.nfce)\r\n-- ================================================================\r\n\r\nSET REQUEST_POOL = 'medium';\r\n\r\n\r\n-- ================================================================\r\n-- TABELA 1: REMESSAS ENVIADAS (Sadas 5901/6901)\r\n-- ================================================================\r\nDROP TABLE IF EXISTS teste.gestex_v014_remessas_enviadas;\r\nCREATE TABLE teste.gestex_v014_remessas_enviadas AS\r\nSELECT\r\n    c.identificadorarquivo,\r\n    c.ano_referencia,\r\n    c.mes_referencia,\r\n    c.chv_nfe,\r\n    c.num_doc,\r\n    c.dt_doc,\r\n    c.dt_e_s,\r\n    c.cod_part                    AS cod_part_industrializador,\r\n    c.vl_doc,\r\n    c.vl_merc,\r\n    c.cod_sit,\r\n    it.num_item,\r\n    it.cod_item,\r\n    it.cfop,\r\n    it.unid,\r\n    it.qtd,\r\n    it.vl_item,\r\n    it.vl_desc,\r\n    it.cst_icms,\r\n    it.aliq_icms,\r\n    it.vl_icms,\r\n    it.vl_ipi\r\nFROM efd.efd_rc100 c, c.listarc170_itensdocumento it\r\nWHERE c.ano_referencia = 2025\r\n  AND c.mes_referencia BETWEEN 1 AND 12\r\n  AND c.ind_oper = 1\r\n  AND c.cod_sit = 0\r\n  AND it.cfop IN (5901, 6901)\r\n;\r\n\r\n\r\n-- ================================================================\r\n-- TABELA 2: REMESSAS RECEBIDAS (Entradas 5901/6901)\r\n-- ================================================================\r\nDROP TABLE IF EXISTS teste.gestex_v014_remessas_recebidas;\r\nCREATE TABLE teste.gestex_v014_remessas_recebidas AS\r\nSELECT\r\n    c.identificadorarquivo,\r\n    c.ano_referencia,\r\n    c.mes_referencia,\r\n    c.chv_nfe,\r\n    c.num_doc,\r\n    c.dt_doc,\r\n    c.dt_e_s,\r\n    c.cod_part                    AS cod_part_encomendante,\r\n    c.vl_",
    "last_modified": "2026-02-18T17:34:48.614",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "01ef3fcc-9258-413a-9870-9f72db37f025",
      1,
      false
    ],
    "dependencies": []
  }
}
]
